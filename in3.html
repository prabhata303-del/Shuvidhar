<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shuvidha Seva</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #673AB7; 
            --primary-gradient: linear-gradient(135deg, #7E57C2 0%, #512DA8 100%); 
            --secondary-color: #f8f9fa;
            --text-color: #212529;
            --light-text: #6c757d;
            --border-color: #ced4da;
            --white: #ffffff;
            --danger: #D84315; 
            --success: #00b894;
            --blue-action: #E91E63;
            --secondary-accent: #E91E63;
        }
        body { margin: 0; font-family: 'Poppins', sans-serif; background-color: #dfe6e9; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: var(--text-color); }
        .mobile-container { width: 100%; max-width: 414px; height: 100vh; max-height: 896px; background-color: var(--secondary-color); border-radius: 0px; overflow: hidden; position: relative; display: flex; flex-direction: column; }
        @media (min-width: 420px) { .mobile-container { border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); height: 90vh; } }
        .page { position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; background-color: var(--secondary-color); display: flex; flex-direction: column; z-index: 1; }
        .page.active { opacity: 1; visibility: visible; z-index: 5; }
        .auth-content { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; background: #ecf0f1; }
        .auth-card { background: white; width: 100%; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.08); overflow: hidden; animation: fadeIn 0.5s ease-out; position: relative; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .auth-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px; background: var(--primary-gradient); }
        .auth-header { text-align: center; padding: 40px 30px 10px 30px; }
        .logo-circle { width: 80px; height: 80px; margin: 0 auto 15px auto; background: var(--white); color: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2em; box-shadow: 0 5px 15px rgba(103, 58, 183, 0.2); overflow: hidden; }
        .logo-circle img { width: 100%; height: 100%; object-fit: contain; }
        .auth-header h1 { font-size: 1.8em; margin: 0; color: #2d3436; font-weight: 700; }
        .auth-header p { color: #b2bec3; font-size: 0.9em; margin-top: 5px; }
        .logo-image-container { width: 50px; height: 50px; margin-right: 10px; border-radius: 50%; overflow: hidden; flex-shrink: 0; background: var(--white); }
        .logo-image-container img { width: 100%; height: 100%; object-fit: contain; }
        .auth-body { padding: 30px; }
        .btn-main { width: 100%; padding: 16px; background: var(--primary-gradient); color: var(--white); border: none; border-radius: 12px; font-size: 1.1em; font-weight: 600; cursor: pointer; box-shadow: 0 8px 20px rgba(103, 58, 183, 0.25); margin-bottom: 15px; transition: transform 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-main:active { transform: scale(0.98); }
        #auth-error { color: var(--danger); text-align: center; margin-bottom: 15px; font-size: 0.9em; background: rgba(216, 67, 21, 0.1); padding: 10px; border-radius: 8px; display: none; }
        .app-header { background: var(--primary-gradient); padding: 50px 20px 20px 20px; color: var(--white); border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; box-shadow: 0 10px 20px rgba(103, 58, 183, 0.15); }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .header-top h1 { font-size: 1.5em; margin: 0; font-weight: 700; display:flex; align-items:center;}
        .search-bar { margin-top: 15px; position: relative; }
        .search-bar input { width: 100%; padding: 15px 20px 15px 45px; border: none; border-radius: 30px; font-size: 1em; box-sizing: border-box; box-shadow: 0 4px 10px rgba(0,0,0,0.1); outline: none; }
        .search-bar .fa-search { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--light-text); }
        main { flex: 1; overflow-y: auto; padding: 0 20px 100px 20px; }
        .section-title { font-size: 1.2em; font-weight: 700; margin: 20px 0 15px 0; color: #2d3436; }
        .horizontal-scroll { display: flex; overflow-x: auto; padding-bottom: 20px; gap: 15px; scroll-behavior: smooth; }
        .horizontal-scroll::-webkit-scrollbar { display: none; }
        #dishesContainer { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding-bottom: 20px; overflow-x: hidden; scroll-behavior: auto; }
        #dishesContainer .card { width: 100%; cursor: pointer; }
        .card { flex-shrink: 0; width: 150px; background-color: var(--white); border-radius: 18px; box-shadow: 0 8px 20px rgba(0,0,0,0.06); overflow: hidden; position: relative; }
        .card img { width: 100%; height: 110px; object-fit: contain; background-color: #f1f2f6; }
        .card-content { padding: 12px; }
        .card-content h3 { margin: 0 0 4px 0; font-size: 0.95em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600;}
        .card-content p { color: var(--primary-color); font-weight: 700; font-size: 0.95em; margin: 0;}
        .card-content p span.original { font-size: 0.8em; color: var(--light-text); text-decoration: line-through; margin-left: 5px; font-weight: 400;}
        .card-actions { position: absolute; bottom: 10px; right: 10px; display: flex; gap: 5px; z-index: 2; }
        .add-btn, .wishlist-btn { background-color: var(--primary-color); color: var(--white); border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(103, 58, 183, 0.4); transition: background-color 0.2s; }
        .wishlist-btn { background-color: rgba(255, 255, 255, 0.8); color: #ccc; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .wishlist-btn.active { background-color: var(--danger); color: var(--white); box-shadow: 0 4px 10px rgba(216, 67, 21, 0.4); }
        .discount-tag { position: absolute; top: 5px; right: 5px; background-color: var(--danger); color: var(--white); padding: 2px 8px; border-radius: 50%; width: 35px; height: 35px; display: flex; justify-content: center; align-items: center; font-size: 0.75em; font-weight: 700; z-index: 5; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1; }
        .card.out-of-stock { opacity: 0.5; pointer-events: none; }
        .out-of-stock-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255, 255, 255, 0.8); display: flex; justify-content: center; align-items: center; font-size: 1em; font-weight: 700; color: var(--danger); z-index: 10; }
        nav { position: fixed; bottom: 0; left: 0; right: 0; height: 70px; background: var(--primary-gradient); box-shadow: 0 -5px 20px rgba(103, 58, 183, 0.3); border-radius: 30px 30px 0 0; z-index: 10; padding: 0 30px; display: flex; justify-content: space-around; align-items: center; max-width: 414px; margin: 0 auto; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: rgba(255, 255, 255, 0.6); cursor: pointer; position: relative; transition: all 0.3s; }
        .nav-item.active { color: #ffffff; text-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .nav-item i { font-size: 1.4em; margin-bottom: 2px;}
        .nav-item p { margin: 0; font-size: 0.7em; font-weight: 500;}
        #cart-fab-container { position: fixed; bottom: 85px; right: 20px; z-index: 100; }
        .fab-btn { width: 60px; height: 60px; background: #ffffff; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: var(--primary-color); font-size: 1.4em; box-shadow: 0 8px 25px rgba(0,0,0,0.15); cursor: pointer; position: relative; transition: transform 0.2s; }
        .fab-btn:active { transform: scale(0.9); }
        #cart-count { position: absolute; top: -2px; right: -2px; background-color: var(--danger); color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 0.8em; display: flex; justify-content: center; align-items: center; font-weight: 800; box-shadow: 0 2px 5px rgba(0,0,0,0.2); border: 2px solid white; }
        .page-header { padding: 40px 20px 20px 20px; text-align: center; position: relative; background: var(--secondary-color); }
        .page-header h2 { margin: 0; font-size: 1.3em; color: #2d3436; font-weight: 700; }
        .back-btn { position: absolute; left: 20px; top: 43px; font-size: 1.3em; cursor: pointer; color: #2d3436; padding: 5px;}
        .page-header.profile-header { background: var(--primary-gradient); color: var(--white); border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; }
        .page-header.profile-header h2, .page-header.profile-header .back-btn { color: var(--white); }
        .cart-item { display: flex; align-items: center; background: var(--white); padding: 12px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .cart-item img { width: 65px; height: 65px; border-radius: 12px; object-fit: cover; margin-right: 15px; }
        .qty-controls { display: flex; align-items: center; gap: 8px; background: #f5f6fa; padding: 5px 10px; border-radius: 20px;}
        .qty-controls button { background: white; border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; color: var(--primary-color); font-weight: bold; box-shadow: 0 2px 5px rgba(103, 58, 183, 0.15); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #2d3436; font-size: 0.9em; }
        .form-control { width: 100%; padding: 14px; border: 1px solid #dfe6e9; border-radius: 12px; box-sizing: border-box; font-family: inherit; background: #fff; }
        .form-control.read-only-field { background: #f1f2f6; color: #636e72; font-weight: 500; }
        .or-divider { display: flex; align-items: center; text-align: center; color: #b2bec3; margin: 25px 0; font-weight: 600; font-size: 0.8em; letter-spacing: 1px; }
        .or-divider::before, .or-divider::after { content: ''; flex: 1; border-bottom: 1px solid #dfe6e9; }
        .or-divider::before { margin-right: 15px; } .or-divider::after { margin-left: 15px; }
        .order-card { background: var(--white); border-radius: 18px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .dp-info-card { display: flex; align-items: center; gap: 15px; background: #f3f0ff; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #dcd4ff; }
        .dp-info-card img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary-color); }
        .dp-info-card h4 { margin: 0; font-size: 1em; color: var(--text-color); }
        .dp-info-card p { margin: 2px 0 0 0; font-size: 0.85em; color: var(--light-text); font-weight: 600;}
        .track-bar { display: flex; justify-content: space-between; position: relative; margin-top: 25px; }
        .track-bar::before { content: ''; position: absolute; top: 8px; left: 0; right: 0; height: 4px; background: #f1f2f6; z-index: 1; border-radius: 2px; }
        .track-step { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; width: 25%; }
        .dot { width: 16px; height: 16px; background: #dfe6e9; border-radius: 50%; border: 2px solid var(--white); transition: all 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .track-step p { font-size: 0.65em; margin-top: 8px; color: #b2bec3; font-weight: 600; text-transform: uppercase; }
        .track-step.active .dot { background: var(--primary-color); transform: scale(1.4); border-color: #fff; }
        .track-step.passed .dot { background: var(--primary-color); }
        .track-step.passed p { color: var(--primary-color); }
        .order-action-buttons { display: flex; gap: 10px; margin-top: 15px; }
        .order-action-buttons button { flex: 1; background: var(--primary-color); color: white; border: none; padding: 10px; border-radius: 8px; font-weight: 600; }
        .slider-container { width: 100%; height: 200px; position: relative; overflow: hidden; background: var(--primary-gradient); margin-bottom: 20px; border-radius: 10px; }
        .slider { display: flex; transition: transform 0.5s ease-in-out; }
        .slide { min-width: 100%; height: 200px; }
        .slide img { width: 100%; height: 100%; object-fit: contain; }
        .fallback-slide { display: flex; justify-content: center; align-items: center; color: white; font-size: 2rem; font-weight: 600; }
        .slider-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; cursor: pointer; z-index: 10; border-radius: 50%; }
        .prev-slide { left: 10px; } .next-slide { right: 10px; }
        .category-item-card { flex-shrink: 0; width: 90px; height: 90px; background-color: var(--white); border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 5px; text-align: center; border: 2px solid transparent; transition: all 0.2s; }
        .category-item-card img { width: 60px; height: 60px; object-fit: contain; margin-bottom: 2px; border-radius: 0; }
        .category-item-card i { font-size: 2em !important; color:var(--primary-color); margin-bottom: 2px; }
        .category-item-card h4 { font-size: 0.75em; margin: 0; font-weight: 600; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%; }
        .category-item-card.active { border-color: var(--primary-color); box-shadow: 0 4px 10px rgba(103, 58, 183, 0.3); background-color: #f8f6ff; }
        .pdp-image-slider-container { width: 100%; height: 250px; overflow: hidden; position: relative; background: #f8f9fa; }
        .pdp-slider { display: flex; transition: transform 0.3s ease-out; height: 100%; }
        .pdp-slide { min-width: 100%; height: 100%; }
        .pdp-slide img { width: 100%; height: 100%; object-fit: contain; }
        .pdp-dots { position: absolute; bottom: 10px; left: 0; right: 0; display: flex; justify-content: center; gap: 5px; }
        .pdp-dot { width: 8px; height: 8px; background: #ccc; border-radius: 50%; cursor: pointer; }
        .pdp-dot.active { background: var(--primary-color); }
        .pdp-info h2 { font-size: 1.6em; font-weight: 700; margin-bottom: 5px; }
        .pdp-info p { color: var(--light-text); margin-bottom: 20px; }
        .pdp-price { font-size: 1.8em; font-weight: 700; color: var(--primary-color); }
        .pdp-price span.original { font-size: 0.6em; color: var(--light-text); text-decoration: line-through; margin-left: 10px; font-weight: 400; }
        .pdp-qty-controls { display: flex; align-items: center; justify-content: space-between; margin-top: 20px; padding: 15px 0; border-top: 1px solid #f1f2f6; }
        .pdp-qty-controls .qty-controls { background: var(--white); border: 1px solid #dfe6e9; }
        .pdp-qty-controls .qty-controls span { font-size: 1.1em; font-weight: 600; }
        #pdpMinQtyWarning { color: var(--danger); font-size: 0.85em; font-weight: 600; margin-top: 5px;}
    </style>
</head>
<body>

    <div class="mobile-container">

        <!-- ===== MODIFIED: LOGIN PAGE (Google Sign-In Only) ===== -->
        <div id="loginPage" class="page">
            <div class="auth-content">
                <div class="auth-card">
                    <div class="auth-header">
                        <div class="logo-circle">
                            <img src="https://i.ibb.co/kgVKVjz0/IMG-20260117-112546.jpg" alt="Shuvidha Seva Logo">
                        </div>
                        <h1>Welcome to Shuvidha Seva</h1>
                        <p>Sign in to continue</p> 
                    </div>
                    
                    <div class="auth-body">
                        <p id="auth-error"></p>
                        
                        <!-- NEW: Google Login Button -->
                        <button class="btn-main" id="googleLoginBtn" style="background: #4285F4; box-shadow: 0 8px 20px rgba(66, 133, 244, 0.25);">
                            <i class="fab fa-google" style="margin-right: 10px;"></i> Sign in with Google
                        </button>
                        
                        <div style="text-align:center; margin-top:20px; font-size:0.8em; color:#636e72;">
                            By logging in, you agree to our 
                            <a href="#" data-page="termsPage">Terms & Conditions</a> 
                            and 
                            <a href="#" data-page="privacyPage">Privacy Policy</a>.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== REMOVED: The entire "registerPage" div is no longer needed ===== -->
        
        <!-- HOME -->
        <div id="appContainer" class="page active">
            <header class="app-header">
                <div class="header-top">
                    <h1>
                        <div class="logo-image-container">
                            <img src="https://i.ibb.co/kgVKVjz0/IMG-20260117-112546.jpg" alt="Shuvidha Seva Logo">
                        </div>
                        Shuvidha Seva 
                    </h1>
                </div>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="home-search-input" placeholder="What are you craving?">
                </div>
            </header>

            <main>
                <h2 class="section-title" style="margin-top: 25px;">Promotions & Offers</h2>
                <div class="slider-container">
                    <div class="slider" id="home-slider"></div>
                    <button class="slider-nav prev-slide"><i class="fas fa-chevron-left"></i></button>
                    <button class="slider-nav next-slide"><i class="fas fa-chevron-right"></i></button>
                </div>
                
                <h2 class="section-title">Browse Categories</h2>
                <div class="horizontal-scroll" id="categoriesContainer"></div>

                <h2 class="section-title" id="dishesSectionTitle">Recommended Dishes</h2>
                <a href="#" id="showAllDishesBtn" onclick="showAllDishes()" style="display:none; font-size:0.9em; color:var(--primary-color); margin-bottom:15px; font-weight:600;">Show All Products</a>
                <div id="dishesContainer"></div>
            </main>

            <div id="cart-fab-container">
                <div class="fab-btn" id="cartFabBtn">
                    <i class="fas fa-shopping-basket"></i>
                    <div id="cart-count">0</div>
                </div>
            </div>

            <nav>
                <div class="nav-item active" data-page="appContainer"><i class="fas fa-home"></i><p>Home</p></div>
                <div class="nav-item" id="ordersNavBtn"><i class="fas fa-receipt"></i><p>Orders</p></div>
                <div class="nav-item" id="wishlistNavBtn"><i class="fas fa-heart"></i><p>Wishlist</p></div>
                <div class="nav-item" id="profileNavBtn"><i class="fas fa-user"></i><p>Profile</p></div>
            </nav>
        </div>

        <!-- PRODUCT DETAIL PAGE (NEW) -->
        <div id="productDetailPage" class="page">
            <header class="page-header">
                <i class="fas fa-arrow-left back-btn" data-target="appContainer"></i>
                <h2 id="pdpHeaderTitle">Product Details</h2>
            </header>
            <div style="flex:1; overflow-y:auto;">
                <div class="pdp-image-slider-container">
                    <div class="pdp-slider" id="pdpSlider"></div>
                    <div class="pdp-dots" id="pdpDots"></div>
                </div>
                <div style="padding: 20px;">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div>
                            <span class="pdp-price" id="pdpPrice">₹0.00</span>
                            <span class="pdp-price" id="pdpOriginalPrice"></span>
                        </div>
                        <div class="discount-tag" id="pdpDiscountTag" style="display:none;"></div>
                    </div>
                    <div class="pdp-info">
                        <h2 id="pdpName"></h2>
                        <p id="pdpUnit"></p>
                    </div>
                    <div class="pdp-qty-controls">
                        <label style="font-weight:600;">Quantity (Max 5):</label>
                        <div class="qty-controls">
                            <button id="pdpQtyMinus"><i class="fas fa-minus"></i></button>
                            <span id="pdpQuantity">1</span>
                            <button id="pdpQtyPlus"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                    <p id="pdpMinQtyWarning">Maximum purchase quantity per item: 5</p> 
                    <button class="btn-main" id="pdpAddToCartBtn" style="margin-top:20px;">
                        <i class="fas fa-shopping-basket"></i> Add to Cart (Max 5)
                    </button>
                    <h3 style="font-size:1.1em; font-weight:700; margin-top:30px; margin-bottom:10px; color:var(--primary-color);">Product Description</h3>
                    <p id="pdpDescription" style="line-height:1.6; color:var(--text-color);"></p>
                    <button class="btn-main wishlist-btn" id="pdpWishlistBtn" style="background:#fff; color:var(--text-color); box-shadow:none; margin-top:30px;">
                       <i class="fas fa-heart" style="color:#ccc;"></i> Add to Wishlist
                    </button>
                </div>
            </div>
        </div>

        <!-- WISHLIST PAGE -->
        <div id="wishlistPage" class="page">
             <header class="page-header">
                <i class="fas fa-arrow-left back-btn" data-target="appContainer"></i>
                <h2>My Wishlist</h2>
            </header>
             <div style="flex:1; padding:20px; overflow-y:auto;" id="wishlistContainer"></div>
        </div>

        <!-- CART -->
        <div id="cartPage" class="page">
            <header class="page-header">
                <i class="fas fa-arrow-left back-btn" data-target="appContainer"></i>
                <h2>My Cart</h2>
            </header>
            <div style="flex:1; padding:20px; overflow-y:auto;" id="cart-content-area">
                <p id="order-constraint-warning" style="color:var(--danger); text-align:center; margin-bottom:15px; display:none;">
                    Minimum order: 3 items AND ₹50.00
                </p>
                <p id="free-delivery-message" style="color:var(--success); text-align:center; margin-bottom:15px; display:none;">
                    You qualify for free delivery!
                </p>
                <div id="cartItemsContainer"></div>
                <div id="cart-summary" style="margin-top:30px; border-top:1px solid var(--border-color); padding-top:20px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>Subtotal</span><span id="subtotal-price">₹0.00</span></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>Delivery Fee</span><span id="delivery-fee-display">₹10.00</span></div>
                    <div style="display:flex; justify-content:space-between; font-weight:700; font-size:1.4em; color:#2d3436; margin-top:10px;"><span>Total</span><span id="total-price">₹10.00</span></div>
                    <button class="btn-main" id="goToCheckoutBtn" style="margin-top:25px;">Proceed to Checkout</button>
                </div>
            </div>
        </div>

        <!-- CHECKOUT -->
        <div id="checkoutPage" class="page">
            <header class="page-header">
                <i class="fas fa-arrow-left back-btn" data-target="cartPage"></i>
                <h2>Checkout</h2>
            </header>
            <div style="flex:1; padding:20px; overflow-y:auto;">
                <h3 style="font-size:1.1em; font-weight:700; margin-bottom:15px; color:var(--primary-color);">1. Confirm Delivery Address</h3>
                <div class="form-group">
                    <label>Customer Name</label>
                    <input type="text" id="addressName" class="form-control" placeholder="Full Name" required>
                </div>
                <div class="form-group">
                    <label>Mobile Number (For Delivery)</label>
                    <input type="tel" id="contactPhone" class="form-control" placeholder="10-digit Mobile Number" maxlength="10" required>
                </div>
                <div class="form-group">
                    <label>Pincode</label>
                    <input type="tel" id="addressPincode" class="form-control" placeholder="Pincode" maxlength="6" required>
                </div>
                <div class="form-group">
                    <label>State & District</label>
                    <input type="text" id="addressStateDistrict" class="form-control read-only-field" readonly>
                </div>
                <div class="form-group">
                    <label>Village / Building / House</label>
                    <input type="text" id="addressFullLine" class="form-control" placeholder="Flat No, Building Name, Village" required>
                </div>
                <div class="form-group">
                    <label>Delivery Instructions / Landmark (Optional)</label>
                    <input type="text" id="addressInstructions" class="form-control" placeholder="e.g., Near Hanuman Temple, Call before arriving">
                </div>
                <div class="or-divider">ORDER CONFIRMATION (COD Only)</div>
                <button class="btn-main" id="placeOrderBtn" disabled>Confirm Order</button>
            </div>
        </div>

        <!-- PROFILE PAGE -->
        <div id="profilePage" class="page">
            <header class="page-header profile-header">
                <i class="fas fa-arrow-left back-btn" data-target="appContainer"></i>
                <h2>My Profile</h2>
            </header>
            <div style="flex:1; padding:20px; overflow-y:auto;">
                 <!-- NOTE: Here you would add an "Edit" button and a form to allow users to update their details -->
                <div class="order-card" style="text-align:center;">
                    <div class="logo-circle" id="profileImageContainer" style="background:var(--secondary-color); margin: 0 auto 15px auto; color:var(--text-color); position:relative; overflow:hidden;">
                        <i class="fas fa-user" id="profileImageDefaultIcon"></i>
                    </div>
                    <h3 id="profileUserName">Loading...</h3>
                    <p id="profileUserEmail">Loading...</p>
                    <p id="profileUserMobileDisplay" style="font-weight: 600;">Mobile: Loading...</p>
                    <p id="profileUserAddressDisplay" style="margin-top: 5px;">Address: Loading...</p>
                    <button class="btn-main" id="profileLogoutBtn" style="background:var(--danger); margin-top:20px; width:50%;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- TERMS & CONDITIONS PAGE -->
        <div id="termsPage" class="page">
            <header class="page-header">
                <i class="fas fa-arrow-left back-btn" data-target="loginPage"></i>
                <h2>Terms & Conditions</h2>
            </header>
            <div style="flex:1; padding:20px; overflow-y:auto; font-size: 0.9em; line-height: 1.6;">
                <h3 style="color:var(--primary-color); margin-top:0;">Terms and Conditions</h3>
                <p><strong>Shuvidha Seva</strong> app ka istemal karne ke liye aapko niche diye gaye niyamo (terms) ka palan karna hoga:</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">1. Minimum Order Rule</h4>
                <p>App se order karne ke liye kam se kam <strong style="color:var(--danger);">3 items</strong> aur kul rashi <strong style="color:var(--danger);">₹50.00</strong> se zyada honi chahiye।</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">2. Delivery Charges</h4>
                <p>Har order par <strong style="color:var(--danger);">₹10 fixed delivery charge</strong> liya jayega, chahe order kitna bhi bada ho।</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">3. Per Item Quantity Rule (Max 5)</h4>
                <p>Aap ek hi product ki zyada se zyada <strong style="color:var(--danger);">5 quantity</strong> order kar sakte hain।</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">4. Account Responsibility</h4>
                <p>Aap apne account ki suraksha ke liye khud zimmedar hain। Galat jankari dene par account band kiya ja sakta hai।</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">5. Delivery Time</h4>
                <p>Hum koshish karte hain ki order jaldi deliver ho, lekin mausam ya traffic ki wajah se deri ho sakti hai।</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">6. Order Cancellation</h4>
                <p>Order place hone ke baad agar humne saaman pack kar diya hai, toh cancellation swikar nahi kiya jayega।</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">7. Contact Us</h4>
                <p>Kisi bhi shikayat ya sawal ke liye aap humein <strong style="color:var(--primary-color);">shuvidhaseva1@gmail.com</strong> par email kar sakte hain।</p>
                <div style="text-align: center; margin-top: 30px; font-size: 0.8em; color: var(--light-text);">&copy; 2026 Shuvidha Seva. All Rights Reserved.</div>
            </div>
        </div>

        <!-- PRIVACY POLICY PAGE -->
        <div id="privacyPage" class="page">
            <header class="page-header">
                <i class="fas fa-arrow-left back-btn" data-target="loginPage"></i>
                <h2>Privacy Policy</h2>
            </header>
            <div style="flex:1; padding:20px; overflow-y:auto; font-size: 0.9em; line-height: 1.6;">
                <h3 style="color:var(--primary-color); margin-top:0;">App & Developer Information</h3>
                <ul style="list-style: none; padding: 0; margin-bottom: 20px;">
                    <li><strong>Application Name:</strong> Shuvidha Seva</li>
                    <li><strong>Package ID:</strong> com.shuvidha.seva</li>
                    <li><strong>Developer:</strong> Prabhat Acharya</li>
                    <li><strong>Contact Email:</strong> shuvidhaseva1@gmail.com</li>
                    <li><strong>Last Updated:</strong> 03 February 2026</li>
                </ul>
                <h3 style="color:var(--primary-color); margin-top:0;">Privacy Policy - Shuvidha Seva</h3>
                <p>Aapki privacy hamare liye bahut mahatvapurn hai। Yeh policy batati hai ki <strong>Shuvidha Seva</strong> aapka data kaise collect aur istemal karta hai।</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">1. Data Jo Hum Collect Karte Hain</h4>
                <p>Hum sirf wahi jankari lete hain jo aapke order ko deliver karne ke liye zaruri hai:</p>
                <ul style="margin-left:20px; margin-top:-5px;"><li>Aapka Naam</li><li>Mobile Number</li><li>Email Address</li><li>Delivery Address (Ghar ka pata)</li></ul>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">2. Data Ka Istemal</h4>
                <p>Aapka data sirf niche diye gaye kaamo ke liye use hota hai:</p>
                <ul style="margin-left:20px; margin-top:-5px;"><li>Aapke order ko process aur deliver karne ke liye।</li><li>Aapko order status updates bhejne ke liye।</li><li>App ki service ko behtar banane ke liye।</li></ul>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">3. Data Security</h4>
                <p>Hum aapka personal data kisi bhi third-party ko bechte ya share nahi karte hain। Aapka data puri tarah surakshit hai।</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">4. Order Rules</h4>
                <p>Shuvidha Seva par order karne ke liye minimum 3 items aur ₹50 ka order, aur maximum 5 quantity per item ka order hona anivarya hai। Har order par ₹10 delivery charge liya jayega।</p>
                <h4 style="color:var(--primary-color); font-weight:700; margin-top:15px; margin-bottom:5px;">5. Contact Us</h4>
                <p>Agar aapko koi sawal hai, toh aap humse <strong style="color:var(--primary-color);">shuvidhaseva1@gmail.com</strong> par sampark kar sakte hain ya app ke support section mein message karein।</p>
                <div style="text-align: center; margin-top: 30px; font-size: 0.8em; color: var(--light-text);"><p>&copy; 2026 Shuvidha Seva. All Rights Reserved.</p></div>
            </div>
        </div>
        
        <!-- ORDERS -->
        <div id="ordersPage" class="page">
            <header class="page-header">
                <i class="fas fa-arrow-left back-btn" data-target="appContainer"></i>
                <h2>My Orders</h2>
            </header>
            <div style="flex:1; padding:20px; overflow-y:auto;" id="ordersListContainer"></div>
        </div>

        <!-- THANK YOU -->
        <div id="thankYouPage" class="page">
            <div style="display:flex; flex-direction:column; justify-content:center; align-items:center; height:100%; padding:40px; text-align:center;">
                <div style="width:100px; height:100px; background:#e0f0ff; border-radius:50%; display:flex; justify-content:center; align-items:center; margin-bottom:20px;">
                    <i class="fas fa-check" style="font-size:3em; color:var(--primary-color);"></i>
                </div>
                <h2 style="color:#2d3436;">Order Placed!</h2>
                <p style="color:#636e72;">Your food is being prepared by Shuvidha Seva. Check your email for confirmation! (Simulated)</p> 
                <button class="btn-main" id="trackOrderBtn" style="margin-top:30px;">Track Order</button>
                <a href="#" id="backToHomeBtn" style="margin-top:20px; display:block; color:var(--light-text); text-decoration:none;">Back to Home</a>
            </div>
        </div>

    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD2ZpkPF0EIT4uK0YULGgBvfU7kHeCml2Q",
            authDomain: "shuvidha-seva-32df0.firebaseapp.com",
            databaseURL: "https://shuvidha-seva-32df0-default-rtdb.firebaseio.com",
            projectId: "shuvidha-seva-32df0",
            storageBucket: "shuvidha-seva-32df0.firebasestorage.app",
            messagingSenderId: "508915247632",
            appId: "1:508915247632:web:91c3df82b4eae3c750f895",
            measurementId: "G-MQ6BPYD4EP"
        };
    </script>
    
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        // ===== MODIFIED: Updated Auth imports for Google Sign-In =====
        import { 
            getAuth, 
            onAuthStateChanged, 
            GoogleAuthProvider,
            signInWithPopup,
            signOut 
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { 
            getDatabase, 
            ref, 
            get, 
            set, 
            onValue, 
            remove, 
            push,
            update
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        
        let cart = [];
        let wishlist = [];
        let currentUser = null;
        let userData = null;
        let userPincode = null;
        let allDishesData = [];
        let ordersListener = null;
        let currentPdpDish = null;
        let pdpQuantity = 1;
        let pdpAutoScrollInterval;

        const MIN_ORDER_QTY = 3; 
        const MIN_ORDER_AMOUNT = 50;
        const MAX_ITEM_QTY = 5;
        
        let adminDeliveryFee = 10.00;
        let freeDeliveryThreshold = 0;

        // --- Placeholders (unchanged) ---
        const placeholderCategories = [ { id: "fastfood", name: "Fast Food", imageUrl: "https://cdn-icons-png.flaticon.com/512/857/857681.png" }, { id: "grocery", name: "Grocery", imageUrl: "https://cdn-icons-png.flaticon.com/512/3081/3081977.png" }, { id: "treats", name: "Treats", imageUrl: "https://cdn-icons-png.flaticon.com/512/4740/4740118.png" }, { id: "indian", name: "Indian", imageUrl: "https://cdn-icons-png.flaticon.com/512/5753/5753127.png" }, ];
        const placeholderSliderImages = [ { downloadURL: "https://i.ibb.co/SwMq0bXj/Picsart-26-01-27-11-31-49-432.png", title: "Aapki Suvidha, Hamari Seva" }, ];
        const placeholderDishes = [ { key: "dish_ff1", name: "Mega Meal Burger Combo", price: { final: 180.00, restaurantPrice: 150.00, adminFee: 30.00 }, discount: 15, unit: "1 Combo", description: "Extra large double patty burger with crispy fries and a soft drink.", imageUrl: "https://i.ibb.co/hJ3RSF0f/pngtree-group-of-fast-food-products-png-image-14008130.png", ac:undefined, images: ["https://i.ibb.co/hJ3RSF0f/pngtree-group-of-fast-food-products-png-image-14008130.png"], categoryId: "fastfood", pincode: "ALL" , isInStock: true }, { key: "dish_ff2", name: "Aloo Samosa (3 Pcs)", price: { final: 45.00, restaurantPrice: 35.00, adminFee: 10.00 }, discount: 0, unit: "3 Pieces", description: "Crispy and hot potato samosas with tangy chutney.", imageUrl: "https://i.ibb.co/yFJw2NQm/samosa-recipe.jpg", images: ["https://i.ibb.co/yFJw2NQm/samosa-recipe.jpg"], categoryId: "fastfood", pincode: "ALL", isInStock: true }, { key: "dish_gr1", name: "Fourtun kachi Ghani 1kg", price: { final: 70.00, restaurantPrice: 65.00, adminFee: 5.00 }, discount: 0, unit: "1kg Pouch", description: "Vacuum sealed for extra freshness.", imageUrl: "https://i.ibb.co/0j6w4zyL/61qs-W9-zfa-L-SX679.jpg", images: ["https://i.ibb.co/0j6w4zyL/61qs-W9-zfa-L-SX679.jpg"], categoryId: "grocery", pincode: "ALL", isInStock: true }, { key: "dish_gr2", name: "Fourtun Soya health 1Kg", price: { final: 65.00, restaurantPrice: 60.00, adminFee: 5.00 }, discount: 5, unit: "1 Kg Pack", description: "Whole wheat flour for soft rotis.", imageUrl: "https://i.ibb.co/pBKKxD0t/612-KEk-Qn-TJL-SX679.jpg", images: ["https://i.ibb.co/pBKKxD0t/612-KEk-Qn-TJL-SX679.jpg"], categoryId: "grocery", pincode: "ALL", isInStock: true }, { key: "dish_tr1", name: "Premium Chocolate Bar", price: { final: 180.00, restaurantPrice: 160.00, adminFee: 20.00 }, discount: 10, unit: "1 Large Bar", description: "A delicious milk chocolate bar with crunchy bits and a smooth center.", imageUrl: "https://i.ibb.co/7JXPjrVT/sliding-images-jpeg-1df64a82-d773-41cd-bcdd-d919c0d65374jpgts1715597648-de4a52a2-8ad3-4360-bd6c-3493.jpg", images: ["https://i.ibb.co/7JXPjrVT/sliding-images-jpeg-1df64a82-d773-41cd-bcdd-d919c0d65374jpgts1715597648-de4a52a2-8ad3-4360-bd6c-3493.jpg"], categoryId: "treats", pincode: "ALL", isInStock: true }, ];
        const simulatedDriver = { name: "Rajesh Kumar (Fallback)", mobile: "9876543210", imageUrl: "https://cdn-icons-png.flaticon.com/512/4140/4140037.png" };
        
        async function fetchThemeAndDeliverySettings() {
             try {
                 const settingsRef = ref(db, 'settings');
                 const snapshot = await get(settingsRef);
                 const settings = snapshot.val() || {};
                 const customerThemeColor = settings.theme?.customerThemeColor;
                 if (customerThemeColor && /^#[0-9A-F]{6}$/i.test(customerThemeColor)) {
                     document.documentElement.style.setProperty('--primary-color', customerThemeColor);
                     document.documentElement.style.setProperty('--primary-gradient', `linear-gradient(135deg, ${customerThemeColor} 0%, ${customerThemeColor} 100%)`);
                 }
                 adminDeliveryFee = parseFloat(settings.delivery?.deliveryFee || 10.00);
                 freeDeliveryThreshold = parseFloat(settings.delivery?.freeDeliveryThreshold || 0);
             } catch (e) {
                 console.error("Failed to fetch settings:", e);
                 adminDeliveryFee = 10.00;
                 freeDeliveryThreshold = 0;
             }
        }

        const showPage = (id) => {
            const restrictedPages = ['ordersPage', 'wishlistPage', 'profilePage', 'cartPage', 'checkoutPage', 'productDetailPage'];
            if (restrictedPages.includes(id) && !currentUser) {
                id = 'loginPage';
            }
            document.querySelectorAll('.page').forEach(p => p.classList.toggle('active', p.id === id));
            document.getElementById('auth-error').style.display = 'none'; 
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const activeNav = document.querySelector(`.nav-item[data-page="${id}"]`);
            if (activeNav) activeNav.classList.add('active');
            if(id === 'checkoutPage' && currentUser) { loadCheckoutAddress(); checkOrderValidity(); }
            if(id === 'ordersPage') loadOrders();
            if(id === 'profilePage') loadProfilePage(); 
            if(id === 'wishlistPage') loadWishlist();
            document.getElementById('cart-fab-container').style.display = (id === 'appContainer') ? 'block' : 'none';
            if (id !== 'productDetailPage' && pdpAutoScrollInterval) { clearInterval(pdpAutoScrollInterval); }
            const scrollableElement = document.querySelector(`#${id} > div:nth-child(2)`);
            if (scrollableElement && scrollableElement.style.overflowY === 'auto') { scrollableElement.scrollTop = 0; }
        };
        
        const authCheckAndNavigate = (targetPage) => {
             if (!currentUser) { showPage('loginPage'); } else { showPage(targetPage); }
        }

        const showError = (msg) => {
            const err = document.getElementById('auth-error');
            err.textContent = msg;
            err.style.display = 'block';
        }

        document.querySelectorAll('[data-target], [data-page]').forEach(b => b.addEventListener('click', (e) => {
                const target = e.currentTarget.dataset.target || e.currentTarget.dataset.page;
                if(target && !['ordersPage', 'wishlistPage', 'profilePage'].includes(target)) { showPage(target); }
            })
        );
        
        document.getElementById('cartFabBtn').onclick = () => authCheckAndNavigate('cartPage');
        document.getElementById('ordersNavBtn').onclick = () => authCheckAndNavigate('ordersPage');
        document.getElementById('wishlistNavBtn').onclick = () => authCheckAndNavigate('wishlistPage');
        document.getElementById('profileNavBtn').onclick = () => authCheckAndNavigate('profilePage');
        document.getElementById('goToCheckoutBtn').onclick = () => showPage('checkoutPage');
        document.getElementById('trackOrderBtn').onclick = () => showPage('ordersPage');
        document.getElementById('backToHomeBtn').onclick = () => showPage('appContainer');
        document.getElementById('profileLogoutBtn').onclick = () => { signOut(auth); cart=[]; wishlist=[]; userPincode=null; userData=null; updateCartUI(); showPage('loginPage'); };

        
        // ===== MODIFIED: AUTHENTICATION (v9 Google Sign-In Only) =====
        document.getElementById('googleLoginBtn').addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            const btn = document.getElementById('googleLoginBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 10px;"></i> Signing In...';
            try {
                // signInWithPopup will trigger onAuthStateChanged on success
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("Google Sign-In Failed:", error.message);
                showError("Could not sign in with Google. Please try again.");
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fab fa-google" style="margin-right: 10px;"></i> Sign in with Google';
            }
        });
        
        // ===== MODIFIED: onAuthStateChanged to handle new user registration =====
        onAuthStateChanged(auth, (user) => {
            fetchThemeAndDeliverySettings();
            currentUser = user;
            if (user) {
                // User is signed in. Check if they are new or returning.
                const userRef = ref(db, 'users/' + user.uid);
                get(userRef).then((snapshot) => {
                    if (snapshot.exists()) {
                        // USER IS RETURNING: Load their data and go to the app.
                        fetchUserPincodeAndData();
                        const currentPage = document.querySelector('.page.active')?.id;
                        if (currentPage === 'loginPage') {
                            showPage('appContainer');
                        }
                    } else {
                        // USER IS NEW: Create their profile and send them to the profile page to complete it.
                        alert("Welcome to Shuvidha Seva! Please complete your profile with a valid Address and Mobile Number to start ordering.");
                        
                        const newUserData = {
                            name: user.displayName || "New User",
                            email: user.email,
                            createdAt: new Date().toISOString(),
                            // These fields must be filled out by the user on the profile page.
                            mobile: "",
                            pincode: "",
                            address: { state: "", district: "", line: "" }
                        };
                        
                        set(userRef, newUserData).then(() => {
                            fetchUserPincodeAndData(); // Load the newly created data
                            showPage('profilePage');   // Force user to profile page
                        });
                    }
                });
                listenForWishlistUpdates();
            } else { 
                // User is signed out.
                currentUser = null; 
                userPincode = null;
                userData = null;
                updateCartUI(); 
                initHomeUI(true); // Show placeholders for guests
                const currentPage = document.querySelector('.page.active')?.id;
                if (['ordersPage', 'wishlistPage', 'profilePage', 'cartPage', 'checkoutPage', 'productDetailPage'].includes(currentPage)) {
                    showPage('loginPage'); 
                }
            }
        });

        async function fetchUserPincodeAndData() {
             if (!currentUser) return;
             try {
                 const snapshot = await get(ref(db, 'users/' + currentUser.uid));
                 const snapData = snapshot.val();
                 if (!snapData) {
                      const dpCheck = await get(ref(db, 'delivery_partners/' + currentUser.uid));
                      if (dpCheck.exists()) {
                          alert("You are logged in as a Delivery Partner. Please use the Partner App.");
                          signOut(auth);
                          return;
                      }
                 }
                 if (snapData) {
                    userData = {
                        name: snapData.name || "User Name",
                        mobile: snapData.mobile || "",
                        email: snapData.email || currentUser.email,
                        pincode: snapData.pincode || "",
                        address: {
                            state: snapData.address?.state || "",
                            district: snapData.address?.district || "",
                            line: snapData.address?.line || ""
                        }
                    };
                    userPincode = userData.pincode;
                 } else {
                     userData = { name: currentUser.displayName, mobile: "", email: currentUser.email, pincode: "", address: { state: "", district: "", line: "" } };
                     userPincode = null;
                 }
                 fetchData();
             } catch (e) {
                 console.error("Failed to fetch user data:", e);
                 userData = { name: currentUser.displayName, mobile: "", email: currentUser.email, pincode: "", address: { state: "", district: "", line: "" } };
                 userPincode = null;
                 fetchData();
             }
        }
        
        function loadCheckoutAddress() {
            if (userData && userData.address) {
                document.getElementById('addressName').value = userData.name || currentUser.displayName;
                document.getElementById('contactPhone').value = userData.mobile || '';
                document.getElementById('addressPincode').value = userData.pincode || '';
                document.getElementById('addressStateDistrict').value = `${userData.address.state || 'N/A'}, ${userData.address.district || 'N/A'}`;
                document.getElementById('addressFullLine').value = userData.address.line || '';
                document.getElementById('addressInstructions').value = '';
            }
        }

        document.getElementById('placeOrderBtn').onclick = async () => {
            if (!currentUser) { alert("Please login to place an order."); showPage('loginPage'); return;}
            const customerName = document.getElementById('addressName').value.trim();
            const phone = document.getElementById('contactPhone').value.trim();
            const pincode = document.getElementById('addressPincode').value.trim();
            const addressFullLine = document.getElementById('addressFullLine').value.trim();
            const stateDistrict = document.getElementById('addressStateDistrict').value;
            const instructions = document.getElementById('addressInstructions').value; 
            if (!customerName || phone.length !== 10 || isNaN(phone) || pincode.length !== 6 || isNaN(pincode) || !addressFullLine) {
                 alert("Please fill in all required fields correctly (Name, 10-digit Mobile, 6-digit Pincode, Address Line).");
                 return;
            }
            const totalQuantity = cart.reduce((a,b)=>a+b.quantity,0);
            const subtotal = cart.reduce((a,b)=>a+b.price*b.quantity,0);
            if (totalQuantity < MIN_ORDER_QTY || subtotal < MIN_ORDER_AMOUNT) { return; }
            const deliveryFee = subtotal >= freeDeliveryThreshold ? 0 : adminDeliveryFee;
            const total = (subtotal + deliveryFee).toFixed(2);
            const fullAddress = `${addressFullLine}, ${stateDistrict} (Pincode: ${pincode}) - Instructions: ${instructions || 'None'}`;
            const itemsToStore = cart.map(item => {
                const fullDish = allDishesData.find(d => d.key === item.id);
                const priceData = fullDish?.price || { final: item.price, restaurantPrice: item.price, adminFee: 0 };
                return { id: item.id, name: item.name, price: parseFloat(item.price).toFixed(2), img: item.img, quantity: item.quantity, restaurantPrice: parseFloat(priceData.restaurantPrice || item.price).toFixed(2), adminFee: parseFloat(priceData.adminFee || 0).toFixed(2) };
            });
            const order = { userId: currentUser.uid, customerName: customerName, email: currentUser.email, phone: phone, address: fullAddress, items: itemsToStore, subtotal: subtotal.toFixed(2), deliveryFee: deliveryFee.toFixed(2), total: total, status: 'PLACED', method: 'COD', timestamp: Date.now() };
            document.getElementById('placeOrderBtn').disabled = true;
            document.getElementById('placeOrderBtn').textContent = 'Confirming Order...';
            try {
                const newOrderRef = push(ref(db, 'orders'));
                await set(newOrderRef, order);
                cart=[]; updateCartUI(); 
                document.getElementById('placeOrderBtn').disabled = false;
                document.getElementById('placeOrderBtn').textContent = 'Confirm Order';
                showPage('thankYouPage'); 
            } catch (e) {
                document.getElementById('placeOrderBtn').disabled = false;
                document.getElementById('placeOrderBtn').textContent = 'Error Confirming Order';
                console.error("Order failed:", e.message);
            }
        };
        
        function checkOrderValidity() {
            const customerName = document.getElementById('addressName')?.value.trim();
            const phoneVal = document.getElementById('contactPhone')?.value.trim();
            const pincodeVal = document.getElementById('addressPincode')?.value.trim();
            const addressLineVal = document.getElementById('addressFullLine')?.value.trim();
            const totalQuantity = cart.reduce((a,b)=>a+b.quantity,0);
            const subtotal = cart.reduce((a,b)=>a+b.price*b.quantity,0);
            const cartConstraintsMet = totalQuantity >= MIN_ORDER_QTY && subtotal >= MIN_ORDER_AMOUNT;
            const isAddressValid = customerName && phoneVal?.length === 10 && !isNaN(phoneVal) && pincodeVal?.length === 6 && !isNaN(pincodeVal) && addressLineVal;
            const orderBtn = document.getElementById('placeOrderBtn');
            const warning = document.getElementById('order-constraint-warning');
            const freeDeliveryMsg = document.getElementById('free-delivery-message');
            if (document.getElementById('cartPage').classList.contains('active')) {
                if (!cartConstraintsMet) {
                    warning.style.display = 'block';
                    warning.innerHTML = `Minimum order: ${MIN_ORDER_QTY} items AND ₹${MIN_ORDER_AMOUNT.toFixed(2)}`;
                    document.getElementById('goToCheckoutBtn').disabled = true;
                    document.getElementById('goToCheckoutBtn').style.opacity = '0.6';
                    freeDeliveryMsg.style.display = 'none';
                } else {
                    warning.style.display = 'none';
                    document.getElementById('goToCheckoutBtn').disabled = false;
                    document.getElementById('goToCheckoutBtn').style.opacity = '1';
                    if (subtotal >= freeDeliveryThreshold) {
                         freeDeliveryMsg.style.display = 'block';
                    } else {
                         freeDeliveryMsg.style.display = 'none';
                    }
                }
            }
            if (orderBtn) {
                if (cartConstraintsMet && isAddressValid) { 
                    orderBtn.disabled = false;
                    orderBtn.style.opacity = '1';
                    orderBtn.textContent = `Confirm Order`;
                } else {
                    orderBtn.disabled = true;
                    orderBtn.style.opacity = '0.6';
                    if (!cartConstraintsMet) {
                        orderBtn.textContent = `Min Order ₹${MIN_ORDER_AMOUNT.toFixed(2)} / ${MIN_ORDER_QTY} items`;
                    } else if (!isAddressValid) {
                        orderBtn.textContent = "Fill all required address details";
                    }
                }
            }
        }
        
        // --- The rest of the JS code (Wishlist, Data Fetching, Cart, UI Rendering, etc.) remains the same ---
        // --- It has been included below for completeness without modification ---
        window.toggleWishlist=async a=>{if(!currentUser)return void showPage("loginPage");const t=allDishesData.find(e=>e.key===a);if(!t)return void console.error("Dish not found for key:",a);if(!1===t.isInStock)return void alert("This product is currently out of stock.");const e=ref(db,`users/${currentUser.uid}/wishlist/${a}`);wishlist.includes(a)?await remove(e):await set(e,{key:t.key,name:t.name,price:parseFloat(t.customerPrice||0),imageUrl:t.images?.[0]||t.imageUrl,discount:t.discount||0,unit:t.unit||"Unit N/A"})};function listenForWishlistUpdates(){currentUser&&onValue(ref(db,`users/${currentUser.uid}/wishlist`),a=>{wishlist=[],a.exists()&&a.forEach(a=>{wishlist.push(a.key)}),document.getElementById("appContainer").classList.contains("active")&&showAllDishes(),document.getElementById("wishlistPage").classList.contains("active")&&loadWishlist(),document.getElementById("productDetailPage").classList.contains("active")&&currentPdpDish&&updatePdpWishlistButton(currentPdpDish.key)})}
        function loadWishlist(){const a=document.getElementById("wishlistContainer");get(ref(db,`users/${currentUser.uid}/wishlist`)).then(e=>{const t=[];e.exists()&&e.forEach(a=>{t.push(a.val())}),a.innerHTML="",0===t.length?a.innerHTML='<div style="text-align:center; margin-top:50px; color:#999;"><i class="fas fa-heart-broken" style="font-size:3em; margin-bottom:15px;"></i><p>Your wishlist is empty. Start adding items!</p></div>':t.forEach(e=>{const t=e.imageUrl||"https://via.placeholder.com/150",s=e.discount||0,i=parseFloat(e.price||0),o=i/(1-s/100);a.innerHTML+=`\n                        <div class="cart-item">\n                            <img src="${t}" alt="${e.name}">\n                            <div style="flex:1;">\n                                <h4 style="margin:0; font-size:1em;">${e.name}</h4>\n                                <p style="margin:2px 0 0 0; color:var(--primary-color); font-weight:600;">₹${i.toFixed(2)}\n                                    ${s>0?`<span style="font-size: 0.8em; color: var(--light-text); text-decoration: line-through; margin-left: 5px;">₹${o.toFixed(2)}</span>`:""}\n                                </p>\n                                ${s>0?`<p style="margin:0; font-size:0.8em; color:var(--danger);">Save ${s}%</p>`:""}\n                            </div>\n                            <div style="display:flex; gap:10px;">\n                                <button class="btn-main" onclick="addToCart('${e.key}', 1)" style="width:auto; padding:8px 15px; font-size:0.9em; margin-bottom:0; background:var(--primary-gradient);">\n                                    <i class="fas fa-shopping-basket"></i> Add\n                                </button>\n                                <button class="wishlist-btn active" onclick="toggleWishlist('${e.key}')" style="background-color: var(--danger); color:white; box-shadow: 0 4px 10px rgba(216, 67, 21, 0.4);">\n                                    <i class="fas fa-trash"></i>\n                                </button>\n                            </div>\n                        </div>\n                    `})})}
        function renderDishes(a){const e=document.getElementById("dishesContainer");e.innerHTML="",0===a.length&&(e.innerHTML='<p style="padding:10px; color:#666; width:100%; text-align:center;">No dishes found for this selection or your Pincode.</p>'),a.forEach(a=>{const t=a.imageUrl||"https://via.placeholder.com/150",s=wishlist.includes(a.key)?"active":"",i=a.discount||0,o=parseFloat(a.customerPrice||0),r=parseFloat(a.price.final||0),l=i>0?`₹${o.toFixed(2)} <span class="original">₹${r.toFixed(2)}</span>`:`₹${r.toFixed(2)}`,n=i>0?`<div class="discount-tag">-${i}%</div>`:"",d=void 0===a.isInStock||a.isInStock,c=!d?'<div class="out-of-stock-overlay">Out of Stock</div>':"",h=!d?"card out-of-stock":"card",p=d?`showProductDetail('${a.key}')`:"alert('This product is out of stock.')";e.innerHTML+=`\n                    <div class="${h}" onclick="${p}"> \n                        ${c}\n                        ${n}\n                        <img src="${t}" alt="${a.name}">\n                        <div class="card-actions">\n                            <button class="wishlist-btn ${s}" onclick="event.stopPropagation(); toggleWishlist('${a.key}')">\n                                <i class="fas fa-heart"></i>\n                            </button>\n                            <button class="add-btn" ${d?"":'disabled'} onclick="event.stopPropagation(); addToCart('${a.key}', 1)">\n                                <i class="fas fa-plus"></i>\n                            </button>\n                        </div>\n                        <div class="card-content">\n                            <h3>${a.name}</h3>\n                            <p>${l}</p>\n                        </div>\n                    </div>\n                `})}
        function renderCategories(a){const e=document.getElementById("categoriesContainer");e.innerHTML="",0===a.length?e.innerHTML='<p style="padding:10px; color:#666; width:100%; text-align:center; font-style:italic;">Admin has not added any categories yet. Please wait.</p>':(e.innerHTML+='\n                 <div class="category-item-card active" data-category="ALL" onclick="showAllDishes()">\n                     <i class="fas fa-list"></i>\n                     <h4>All</h4>\n                 </div>\n            ',a.forEach(a=>{const t=a.id||a.name,s=a.imageUrl?`<img src="${a.imageUrl}" alt="${a.name}">`:'<i class="fas fa-utensils"></i>';e.innerHTML+=`\n                    <div class="category-item-card" data-category="${t}" onclick="filterDishesByCategory('${t}')">\n                        ${s}\n                        <h4>${a.name}</h4>\n                    </div>\n                `}),document.querySelector('.category-item-card[data-category="ALL"]')&&(document.querySelectorAll(".category-item-card").forEach(a=>a.classList.remove("active")),document.querySelector('.category-item-card[data-category="ALL"]')?.classList.add("active")))}
        function renderSlider(a){const e=document.getElementById("home-slider"),t=document.querySelector(".next-slide"),s=document.querySelector(".prev-slide"),i=a.length>0?a:placeholderSliderImages;0===i.length?(e.innerHTML='<div class="slide fallback-slide">Welcome to Shuvidha Seva</div>',t.style.display="none",s.style.display="none"):(e.innerHTML=i.map(a=>`\n                <div class="slide"><img src="${a.downloadURL}" alt="Slider Image"></div>\n            `).join(""),i.length>1?(initSlider(),t.style.display="block",s.style.display="block"):(e.style.transform="translateX(0%)",t.style.display="none",s.style.display="none"))}
        async function fetchData(){try{let a=await get(ref(db,"categories"));let e=[];a.forEach(a=>{e.push({id:a.key,...a.val()})}),renderCategories(e.length>0?e:placeholderCategories),a=await get(ref(db,"dishes")),allDishesData=[],a.forEach(a=>{const e={key:a.key,...a.val()};e.categoryId=e.categoryId||"uncategorized",e.pincode=e.pincode||"ALL",e.discount=e.discount||0,e.unit=e.unit||"Unit N/A",e.description=e.description||"No description available.",e.isInStock=void 0===e.isInStock||e.isInStock,e.price=e.price&&"object"==typeof e.price?e.price:{final:parseFloat(e.price||0),restaurantPrice:parseFloat(e.price||0),adminFee:0};const t=parseFloat(e.price.final||0);e.customerPrice=t*(1-e.discount/100),e.images=Array.isArray(e.images)&&e.images.length>0?e.images:[e.imageUrl||"https://via.placeholder.com/150"],userPincode&&"ALL"!==e.pincode&&e.pincode!==userPincode||allDishesData.push(e)}),showAllDishes(),a=await get(ref(db,"banners"));const t=[];a.forEach(a=>{const e=a.val();e.imageUrl&&t.push({downloadURL:e.imageUrl,title:e.title})}),renderSlider(t)}catch(a){console.error("Error fetching app data:",a),allDishesData=placeholderDishes.map(a=>{const e=a.price,t=parseFloat(e.final||0);return{...a,price:e,customerPrice:t*(1-(a.discount||0)/100)}}),renderCategories(placeholderCategories),showAllDishes(),renderSlider(placeholderSliderImages)}}
        window.filterDishesByCategory=a=>{const e=allDishesData.filter(e=>e.categoryId===a);document.querySelectorAll(".category-item-card").forEach(e=>e.classList.remove("active")),document.querySelector(`.category-item-card[data-category="${a}"]`)?.classList.add("active"),renderDishes(e),document.getElementById("showAllDishesBtn").style.display="block",document.getElementById("dishesSectionTitle").textContent="Dishes in Category",document.getElementById("dishesSectionTitle").scrollIntoView({behavior:"smooth"})},window.showAllDishes=()=>{renderDishes(allDishesData),document.getElementById("showAllDishesBtn").style.display="none",document.getElementById("dishesSectionTitle").textContent="Recommended Dishes",document.querySelectorAll(".category-item-card").forEach(a=>a.classList.remove("active")),document.querySelector('.category-item-card[data-category="ALL"]')?.classList.add("active")},document.getElementById("home-search-input").addEventListener("input",a=>{const e=a.target.value.toLowerCase(),t=allDishesData.filter(a=>a.name.toLowerCase().includes(e));renderDishes(t),document.getElementById("showAllDishesBtn").style.display="block",document.getElementById("dishesSectionTitle").textContent=`Search Results for "${a.target.value}"`}),window.addToCart=(a,e=1)=>{if(!currentUser)return void showPage("loginPage");const t=allDishesData.find(e=>e.key===a);if(!t)return void console.error("Dish not found for key:",a);if(!1===t.isInStock)return void alert("This product is currently out of stock.");const s=parseFloat(t.customerPrice||0),i=cart.find(e=>e.id===a);let o=e;if(i&&(o=i.quantity+e),o>MAX_ITEM_QTY){if(alert(`Cannot add. Maximum quantity for this item is ${MAX_ITEM_QTY}.`),i&&i.quantity<MAX_ITEM_QTY&&1===e)i.quantity=MAX_ITEM_QTY,alert(`Quantity automatically adjusted to the maximum of ${MAX_ITEM_QTY}.`);else return}else i?i.quantity=o:cart.push({id:t.key,name:t.name,price:s,img:t.imageUrl,quantity:o});updateCartUI()},window.modQty=(a,e)=>{const t=cart.find(e=>e.id===a);t&&(t.quantity+=e)<1?cart=cart.filter(e=>e.id!==a):t.quantity>MAX_ITEM_QTY?alert(`Cannot increase quantity above maximum limit of ${MAX_ITEM_QTY}.`):updateCartUI()};
        function updateCartUI(){const a=document.getElementById("cartItemsContainer");let e=0;if(a.innerHTML="",0===cart.length)a.innerHTML='<p style="text-align:center; color:#777; margin-top:50px;"><i class="fas fa-shopping-basket" style="font-size:2em; margin-bottom:10px;"></i><br>Your cart is empty.</p>';else for(const t of cart){const s=t.price*t.quantity;e+=s;const i=t.img||"https://via.placeholder.com/150";a.innerHTML+=`\n                        <div class="cart-item">\n                            <img src="${i}" alt="${t.name}">\n                            <div style="flex:1;">\n                                <h4 style="margin:0; font-size:1em;">${t.name}</h4>\n                                <p style="margin:2px 0 0 0; color:var(--primary-color); font-weight:600;">₹${t.price.toFixed(2)} x ${t.quantity} = ₹${s.toFixed(2)}</p>\n                            </div>\n                            <div class="qty-controls">\n                                <button onclick="modQty('${t.id}',-1)"><i class="fas fa-minus"></i></button>\n                                <span>${t.quantity}</span>\n                                <button onclick="modQty('${t.id}',1)"><i class="fas fa-plus"></i></button>\n                            </div>\n                        </div>\n                    `}const t=e>=freeDeliveryThreshold?0:adminDeliveryFee,s=e+t;document.getElementById("subtotal-price").textContent=`₹${e.toFixed(2)}`,document.getElementById("delivery-fee-display").textContent=0===t?"Free":`₹${t.toFixed(2)}`,document.getElementById("total-price").textContent=`₹${s.toFixed(2)}`,document.getElementById("cart-count").textContent=cart.reduce((a,e)=>a+e.quantity,0),checkOrderValidity()}
        window.showProductDetail=a=>{if(!currentUser)return void showPage("loginPage");if(currentPdpDish=allDishesData.find(e=>e.key===a)){const e=currentPdpDish.discount||0,t=parseFloat(currentPdpDish.price.final||0),s=parseFloat(currentPdpDish.customerPrice||0);document.getElementById("pdpHeaderTitle").textContent=currentPdpDish.name,document.getElementById("pdpName").textContent=currentPdpDish.name,document.getElementById("pdpUnit").textContent=`Unit: ${currentPdpDish.unit||"Unit N/A"}`,document.getElementById("pdpDescription").innerHTML=currentPdpDish.description||"No description available for this product.",document.getElementById("pdpPrice").textContent=`₹${s.toFixed(2)}`,e>0?(document.getElementById("pdpOriginalPrice").innerHTML=`<span class="original">₹${t.toFixed(2)}</span>`,document.getElementById("pdpDiscountTag").style.display="flex",document.getElementById("pdpDiscountTag").textContent=`-${e}%`):(document.getElementById("pdpOriginalPrice").innerHTML="",document.getElementById("pdpDiscountTag").style.display="none"),updatePdpWishlistButton(a),pdpQuantity=1,document.getElementById("pdpQuantity").textContent=pdpQuantity;const i=void 0===currentPdpDish.isInStock||currentPdpDish.isInStock,o=document.getElementById("pdpAddToCartBtn"),r=document.getElementById("pdpMinQtyWarning");i?(o.disabled=!1,o.textContent=`Add to Cart (Max ${MAX_ITEM_QTY})`,r.textContent=`प्रति वस्तु अधिकतम खरीद मात्रा: ${MAX_ITEM_QTY}`,r.style.color="var(--danger)"):(o.disabled=!0,o.textContent="Out of Stock",r.textContent="This product is currently out of stock.",r.style.color="var(--danger)");const l=currentPdpDish.images||[currentPdpDish.imageUrl||"https://via.placeholder.com/150"],n=document.getElementById("pdpSlider"),d=document.getElementById("pdpDots");n.innerHTML=l.map(a=>`<div class="pdp-slide"><img src="${a}" alt="${currentPdpDish.name}"></div>`).join(""),d.innerHTML=l.map((a,e)=>`\n                <div class="pdp-dot ${0===e?"active":""}" onclick="goToPdpSlide(${e})"></div>\n            `).join(""),n.style.transform="translateX(0%)",pdpCurrentSlide=0,clearInterval(pdpAutoScrollInterval),l.length>1&&(pdpAutoScrollInterval=setInterval(pdpNextSlide,2e3)),showPage("productDetailPage")}}
        function updatePdpWishlistButton(a){const e=document.getElementById("pdpWishlistBtn"),t=wishlist.includes(a),s=t?"var(--danger)":"#ccc";e.className=`btn-main wishlist-btn ${t?"active":""}`,e.innerHTML=`<i class="fas fa-heart" style="color:${s};"></i> ${t?"Remove from Wishlist":"Add to Wishlist"}`,e.onclick=()=>toggleWishlist(a)}
        let pdpCurrentSlide=0;window.goToPdpSlide=a=>{const e=document.getElementById("pdpSlider"),t=document.querySelectorAll("#pdpDots .pdp-dot");if(a>=0&&a<t.length)e.style.transform=`translateX(-${100*a}%)`,t.forEach((e,t)=>e.classList.toggle("active",t===a)),pdpCurrentSlide=a},window.pdpNextSlide=()=>{const a=document.querySelectorAll("#pdpDots .pdp-dot");if(!(a.length<=1)){let e=pdpCurrentSlide+1;e>=a.length&&(e=0),window.goToPdpSlide(e)}},document.getElementById("pdpQtyMinus").onclick=()=>{pdpQuantity>1&&(pdpQuantity--,document.getElementById("pdpQuantity").textContent=pdpQuantity)},document.getElementById("pdpQtyPlus").onclick=()=>{pdpQuantity<MAX_ITEM_QTY?(pdpQuantity++,document.getElementById("pdpQuantity").textContent=pdpQuantity):alert(`Cannot add more. Maximum quantity per item is ${MAX_ITEM_QTY}.`)},document.getElementById("pdpAddToCartBtn").onclick=()=>{if(!currentUser)return void showPage("loginPage");if(currentPdpDish){const a=cart.find(a=>a.id===currentPdpDish.key),e=a?a.quantity:0;if(e+pdpQuantity>MAX_ITEM_QTY)return void alert(`You can only have a maximum of ${MAX_ITEM_QTY} of this item in your cart (Current: ${e}, Adding: ${pdpQuantity}). Please reduce the quantity.`);window.addToCart(currentPdpDish.key,pdpQuantity),alert(`${pdpQuantity} x ${currentPdpDish.name} added to cart!`),showPage("cartPage")}};
        function loadProfilePage(){currentUser&&userData?(document.getElementById("profileUserName").textContent=userData.name||currentUser.displayName,document.getElementById("profileUserEmail").textContent=userData.email||"N/A",document.getElementById("profileUserMobileDisplay").textContent=`Mobile: ${userData.mobile||"Not Set"}`,document.getElementById("profileUserAddressDisplay").textContent=`Address: ${`${userData.address?.line||"Not Set"}, ${userData.address?.district||""}, ${userData.address?.state||""} - ${userData.pincode||""}`}`):(document.getElementById("profileUserName").textContent="Guest User",document.getElementById("profileUserEmail").textContent="Please log in",document.getElementById("profileUserMobileDisplay").textContent="Mobile: N/A",document.getElementById("profileUserAddressDisplay").textContent="Address: N/A")}
        window.confirmCancelOrder=a=>{confirm("Kya aap sach mein yeh order cancel karna chahte hain? Ek baar cancel hone ke baad wapas nahi ho payega.")&&cancelOrder(a)},window.cancelOrder=async a=>{if(currentUser){const e=document.querySelector(`#order-${a} .cancel-order-btn`);e&&(e.disabled=!0,e.textContent="Cancelling...");try{await update(ref(db,`orders/${a}`),{status:"CANCELLED",cancellationReason:"Cancelled by customer via app."})}catch(a){alert("Order cancel karne mein fail ho gaye. Kripya dobara try karein."),console.error("Cancellation Failed:",a),e&&(e.disabled=!1,e.textContent="Order Cancel Karein")}}},window.confirmDeleteOrder=a=>{confirm("Kya aap sach mein yeh order history se hatana chahte hain?")&&deleteOrder(a)},window.deleteOrder=async a=>{if(currentUser)try{await remove(ref(db,`orders/${a}`))}catch(a){alert("Order history se hatane mein fail ho gaye. Kripya dobara try karein."),console.error("Deletion Failed:",a)}};
        function updateOrderCardHTML(a){let e,t,s,i="";const o=a.customerStatus;if(o.startsWith("Cancelled"))e=t=s="passed";else if("Done"!==o)"Placed"===o?i="active":"Preparing"===o?(i="active",e="passed"):"On Way"===o&&(i="active",e=t="passed");else e=t=s="active";const r=Array.isArray(a.items)?a.items:a.items?Object.values(a.items):[];let l=r.map(a=>{const e=parseFloat(a.price||0).toFixed(2),t=(parseFloat(a.price||0)*parseFloat(a.quantity||0)).toFixed(2),s=a.img||"https://via.placeholder.com/150",i="CANCELLED_OUT_OF_STOCK"===a.status,o=i?"opacity: 0.5; text-decoration: line-through;":"",r=i?'<span style="color:var(--danger); font-size:0.8em; font-weight:600;">(Out of Stock)</span>':"";return`\n                     <div style="display:flex; align-items:center; margin-bottom:10px; border-bottom:1px solid #f1f2f6; padding-bottom:10px; ${o}">\n                         <img src="${s}" alt="${a.name}" style="width:50px; height:50px; border-radius:8px; object-fit:cover; margin-right:10px;">\n                         <div style="flex:1;">\n                             <h5 style="margin:0; font-size:0.9em;">${a.name} ${r}</h5>\n                             <p style="margin:0; font-size:0.8em; color:#636e72;">Qty: ${a.quantity} | ₹${e}/each</p>\n                         </div>\n                         <span style="font-weight:700; color:var(--text-color); flex-shrink:0;">₹${t}</span>\n                     </div>\n                 `}).join("");let n="",d="";let c=o.startsWith("Cancelled")?"var(--danger)":"Done"===o?"var(--success)":"var(--primary-color)";if("Placed"===o)n=`\n                      <div class="order-action-buttons">\n                          <button class="btn-main cancel-order-btn" onclick="confirmCancelOrder('${a.k}')" style="background:var(--danger); width:100%; margin-top:0; box-shadow:none;">\n                              <i class="fas fa-times-circle"></i> Order Cancel Karein\n                          </button>\n                      </div>\n                  `;else if("Done"===o||o.startsWith("Cancelled"))n=`\n                      <div class="order-action-buttons">\n                          <button class="btn-main delete-order-btn" onclick="confirmDeleteOrder('${a.k}')" style="background:#6c757d; width:100%; margin-top:0; box-shadow:none; font-size:0.9em; padding:10px;">\n                              <i class="fas fa-trash-alt"></i> History Se Hatayein \n                          </button>\n                      </div>\n                  `;else if("On Way"===o&&a.driverDetails)d=`\n                     <div class="dp-info-card">\n                         <img src="${a.driverDetails.imageUrl}" alt="${a.driverDetails.name}">\n                         <div>\n                             <h4>Delivery Partner: ${a.driverDetails.name}</h4>\n                             <p>Mobile: ${a.driverDetails.mobile}</p>\n                             <p style="font-weight:700; color:var(--danger); font-size:0.8em;">**Aapka order nikal chuka hai!**</p>\n                         </div>\n                     </div>\n                  `,n=`\n                      <div class="order-action-buttons">\n                          <button onclick="window.open('tel:${a.driverDetails.mobile}', '_system')" style="width:100%;"><i class="fas fa-phone"></i> Call Delivery Boy</button>\n                      </div>\n                  `;let h=`\n                 <div class="track-bar">\n                     <div class="track-step ${e}"><div class="dot"></div><p>Placed</p></div>\n                     <div class="track-step ${t}"><div class="dot"></div><p>Prep</p></div>\n                     <div class="track-step ${s}"><div class="dot"></div><p>On Way</p></div>\n                     <div class="track-step ${i}"><div class="dot"></div><p>Done</p></div>\n                 </div>\n             `;return"Done"===o||o.startsWith("Cancelled")?h=`\n                     <div class="track-bar">\n                         <div class="track-step passed"><div class="dot"></div><p>Placed</p></div>\n                         <div class="track-step passed"><div class="dot"></div><p>Prep</p></div>\n                         <div class="track-step passed"><div class="dot"></div><p>On Way</p></div>\n                         <div class="track-step passed" style="width:25%;"><div class="dot" style="background: ${o.startsWith("Cancelled")?"var(--danger)":"var(--primary-color)"};"></div><p style="color:${o.startsWith("Cancelled")?"var(--danger)":"var(--primary-color)"};">${o}</p></div>\n                     </div>\n                  `:`\n                 <div class="order-card" id="order-${a.k}">\n                     <div style="display:flex;justify-content:space-between;font-weight:600; margin-bottom:10px;">\n                         <span>Order ID: #${a.k.substring(1,6)}</span>\n                         <span style="color:${c}">${o}</span>\n                     </div>\n                     \n                     ${d} \n\n                     <div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 10px;">\n                         ${l}\n                         <div style="display:flex; justify-content:space-between; font-weight:700; margin-top:10px; padding-top:10px; border-top:1px dashed #dfe6e9;">\n                             <span>Payment Method:</span>\n                             <span style="color:var(--success);">${a.method}</span>\n                         </div>\n                         <div style="display:flex; justify-content:space-between; font-weight:700; font-size:1.1em; color:var(--primary-color); margin-top:5px;">\n                             <span>Total Amount:</span>\n                             <span>₹${a.total}</span>\n                         </div>\n                     </div>\n\n                     <p style="font-size:0.9em; color:#636e72; margin-top: 10px; margin-bottom: 20px;">\n                         **Delivering to:** ${a.address} \n                     </p>\n                     \n                     ${a.cancellationReason&&a.status.startsWith("CANCELLED")?`<p style="color:var(--danger); font-size:0.9em; font-weight:600; margin-top:-10px;">Cancellation Reason: ${a.cancellationReason}</p>`:""}\n\n\n                     ${h}\n                     \n                     ${n}\n                 </div>\n             `}
        async function loadOrders(){const a=document.getElementById("ordersListContainer");if(!currentUser)return void(a.innerHTML='<p style="text-align:center; color:#777; padding:20px;">Please log in to see your orders.</p>');a.innerHTML='<p style="text-align:center; padding:20px;">Loading...</p>';const e=ref(db,"orders");ordersListener&&ordersListener(),ordersListener=onValue(e,async e=>{const t=[],s={};let i=!1;const o=[];e.forEach(a=>{const e=a.val();e.userId===currentUser.uid&&(i=!0,e.customerStatus={PLACED:"Placed",ACCEPTED:"Preparing",PREPARING:"Preparing",READY_FOR_PICKUP:"Preparing",PICKED_UP:"On Way",OUT_FOR_DELIVERY:"On Way",DELIVERED:"Done",CANCELLED:"Cancelled",CANCELLED_BY_DP:"Cancelled (DP)",CANCELLED_NO_ITEMS:"Cancelled (No Items)",CANCELLED_BY_ADMIN:"Cancelled (Admin)"}[e.status]||"Processing",e.k=a.key,"On Way"===e.customerStatus&&e.dboyId&&!s[e.dboyId]&&o.push(get(ref(db,`delivery_partners/${e.dboyId}`)).then(a=>{const e=a.val();s[e.dboyId]=e?{name:e.name,mobile:e.mobile,imageUrl:e.profileImageUrl||"https://cdn-icons-png.flaticon.com/512/4140/4140037.png"}:simulatedDriver}).catch(a=>{console.error("Error fetching DP data:",a),s[e.dboyId]=simulatedDriver})),t.push(e))}),o.length>0&&await Promise.all(o),t.forEach(a=>{"On Way"===a.customerStatus&&a.dboyId?a.driverDetails=s[a.dboyId]:a.driverDetails=null}),i?(t.sort((a,e)=>e.timestamp-a.timestamp),a.innerHTML=t.map(updateOrderCardHTML).join(""),document.querySelectorAll("[data-page]").forEach(a=>a.addEventListener("click",a=>{const e=a.currentTarget.dataset.target||a.currentTarget.dataset.page;e&&showPage(e)}))):a.innerHTML='<p style="text-align:center; color:#777; padding:20px;">Abhi koi order nahi hai. Naya order place karein!</p>'})}
        function initHomeUI(a=!1){placeholderDishes.some(a=>!a.customerPrice)&&placeholderDishes.forEach(a=>{const e=a.price&&"object"==typeof a.price?a.price:{final:parseFloat(a.price||0),restaurantPrice:parseFloat(a.price||0),adminFee:0},t=parseFloat(e.final||0);a.price=e,a.customerPrice=t*(1-(a.discount||0)/100)}),renderCategories(placeholderCategories),renderSlider(placeholderSliderImages);const e=placeholderDishes.filter(a=>"ALL"===a.pincode);allDishesData=e,renderDishes(e),document.querySelector(".page.active")||document.getElementById("appContainer").classList.add("active")}
        let currentSlide=0,slideInterval;const initSlider=()=>{const a=document.querySelectorAll("#home-slider .slide");if(!(a.length<=1)){const e=document.getElementById("home-slider"),t=document.querySelector(".next-slide"),s=document.querySelector(".prev-slide");clearInterval(slideInterval);const i=a=>{e.style.transform=`translateX(-${100*a}%)`,currentSlide=a},o=()=>{let e=currentSlide+1;e>=a.length&&(e=0),i(e)},r=()=>{let e=currentSlide-1;e<0&&(e=a.length-1),i(e)},l=()=>{clearInterval(slideInterval),slideInterval=setInterval(o,5e3)};t.onclick=()=>{o(),l()},s.onclick=()=>{r(),l()},l()}};initHomeUI(!0),updateCartUI();
    </script>
</body>
</html>